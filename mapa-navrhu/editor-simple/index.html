---
layout: default
title: JednoduchÃ½ editor nÃ¡vrhÅ¯
---

<style>
  .simple-editor {
    display: flex;
    gap: 20px;
    margin: 20px 0;
    min-height: 80vh;
  }
  
  .map-container {
    flex: 2;
    position: relative;
    background: #f0f0f0;
    border-radius: 8px;
    overflow: hidden;
  }
  
  .form-container {
    flex: 1;
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  #map {
    width: 100%;
    height: 100%;
    min-height: 600px;
  }
  
  .form-group {
    margin-bottom: 15px;
  }
  
  .form-group label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
  }
  
  .form-group input, .form-group select, .form-group textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
  }
  
  .form-group textarea {
    min-height: 100px;
    resize: vertical;
  }
  
  .btn {
    background: #007cba;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer;
    margin-right: 10px;
    margin-bottom: 10px;
  }
  
  .btn:hover {
    background: #005a87;
  }
  
  .btn:disabled {
    background: #ccc;
    cursor: not-allowed;
  }
  
  .tools {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 1000;
    background: white;
    padding: 10px;
    border-radius: 4px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }
  
  .status {
    background: #e7f3ff;
    padding: 10px;
    border-radius: 4px;
    margin-bottom: 15px;
  }
  
  .password-form {
    max-width: 400px;
    margin: 50px auto;
    padding: 30px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    text-align: center;
  }
  
  .password-form input {
    width: 100%;
    padding: 12px;
    margin: 10px 0;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
  }
</style>

<div class="md-section">
  <h1>JednoduchÃ½ editor nÃ¡vrhÅ¯</h1>
  
  <div id="password-screen" class="password-form">
    <h3>ğŸ” PÅ™Ã­stup do editoru</h3>
    <p>Pro vytvÃ¡Å™enÃ­ nÃ¡vrhÅ¯ je potÅ™eba heslo.</p>
    <input type="password" id="password" placeholder="Zadejte heslo" />
    <br><br>
    <button class="btn" onclick="login()">PÅ™ihlÃ¡sit se</button>
  </div>
  
  <div id="editor-screen" style="display: none;">
    <div class="simple-editor">
      <div class="map-container">
        <div class="tools">
          <button class="btn" onclick="setMode('point')" id="btn-point">ğŸ“ Bod</button>
          <button class="btn" onclick="setMode('line')" id="btn-line">â– Linie</button>
          <button class="btn" onclick="setMode('polygon')" id="btn-polygon">ğŸ”· Oblast</button>
          <button class="btn" onclick="clearMap()">ğŸ—‘ï¸ Smazat</button>
          <button class="btn" onclick="finishDrawing()" id="btn-finish" style="display:none; background:#28a745;">âœ… DokonÄit</button>
        </div>
        <div id="map"></div>
      </div>
      
      <div class="form-container">
        <div class="status" id="status">
          KliknÄ›te na tlaÄÃ­tko "ğŸ“ Bod" a pak na mapu pro oznaÄenÃ­ mÃ­sta.
        </div>
        
        <form id="proposal-form">
          <div class="form-group">
            <label>NÃ¡zev nÃ¡vrhu *</label>
            <input type="text" id="title" required />
          </div>
          
          <div class="form-group">
            <label>Autor *</label>
            <input type="text" id="author" required />
          </div>
          
          <div class="form-group">
            <label>Kategorie *</label>
            <select id="category" required>
              <option value="">Vyberte...</option>
              <option value="infrastruktura">ğŸ—ï¸ Infrastruktura</option>
              <option value="zelen">ğŸŒ³ VeÅ™ejnÃ¡ zeleÅˆ</option>
              <option value="doprava">ğŸšŒ Doprava</option>
              <option value="sportoviste">ğŸ® SportoviÅ¡tÄ›</option>
              <option value="budovy">ğŸ¢ VeÅ™ejnÃ© budovy</option>
              <option value="smart-city">ğŸ’¡ Smart city</option>
              <option value="prostredi">â™»ï¸ Å½ivotnÃ­ prostÅ™edÃ­</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Status</label>
            <select id="status">
              <option value="navrh">ğŸ”µ NÃ¡vrh</option>
              <option value="schvaleno">ğŸŸ¡ SchvÃ¡leno</option>
              <option value="realizace">ğŸŸ£ V realizaci</option>
              <option value="hotovo">ğŸŸ¢ Hotovo</option>
              <option value="zamitnuto">ğŸ”´ ZamÃ­tnuto</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>RozpoÄet</label>
            <input type="text" id="budget" placeholder="napÅ™. 2.5M KÄ" />
          </div>
          
          <div class="form-group">
            <label>Adresa</label>
            <input type="text" id="address" readonly />
          </div>
          
          <div class="form-group">
            <label>Popis *</label>
            <textarea id="description" required placeholder="DetailnÃ­ popis nÃ¡vrhu..."></textarea>
          </div>
          
          <div class="form-group">
            <button type="button" class="btn" onclick="generateMd()" id="btn-generate" disabled>
              ğŸ’¾ StÃ¡hnout .md soubor
            </button>
            <button type="button" class="btn" onclick="showPreview()">
              ğŸ‘ï¸ NÃ¡hled
            </button>
            <button type="button" class="btn" onclick="resetForm()" style="background: #dc3545;">
              ğŸ”„ Reset
            </button>
          </div>
        </form>
        
        <div id="coordinates" style="font-size: 12px; color: #666; margin-top: 10px;"></div>
      </div>
    </div>
  </div>
</div>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// GlobÃ¡lnÃ­ promÄ›nnÃ©
let map = null;
let currentMarker = null;
let currentMode = null;
let markerData = null;
let drawingPoints = [];
let currentDrawing = null;
let tempMarkers = [];

// PÅ™ihlÃ¡Å¡enÃ­
function login() {
  const password = document.getElementById('password').value;
  if (password === 'brandys2025') {
    document.getElementById('password-screen').style.display = 'none';
    document.getElementById('editor-screen').style.display = 'block';
    setTimeout(initializeMap, 100);
  } else {
    alert('NesprÃ¡vnÃ© heslo!');
  }
}

// Inicializace mapy
function initializeMap() {
  console.log('Inicializuji mapu...');
  
  try {
    if (typeof L === 'undefined') {
      console.error('Leaflet nenÃ­ dostupnÃ½!');
      return;
    }
    
    // VytvoÅ™enÃ­ mapy
    map = L.map('map').setView([50.1872, 14.6634], 15);
    
    // ZÃ¡kladnÃ­ vrstva
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);
    
    // KatastrÃ¡lnÃ­ vrstva - pouze parcely a budovy, bez popiskÅ¯
    const cadastralLayer = L.tileLayer.wms('https://services.cuzk.cz/wms/wms.asp', {
      layers: 'DEF_PARCELY,DEF_BUDOVY',
      format: 'image/png',
      transparent: true,
      attribution: 'Â© ÄŒÃšZK',
      opacity: 0.5,
      interactive: false,  // DÅ¯leÅ¾itÃ© - vrstva nebude blokovat kliknutÃ­
      styles: '',  // Skryjeme textovÃ© popisky parcel
      maxZoom: 18
    });
    cadastralLayer.addTo(map);
    
    // Event pro kliknutÃ­ na mapu - bude fungovat vÅ¡ude
    map.on('click', onMapClick);
    
    console.log('Mapa inicializovÃ¡na ÃºspÄ›Å¡nÄ›');
    updateStatus('Mapa naÄtena. Vyberte nÃ¡stroj a kliknÄ›te na mapu.');
    
  } catch (error) {
    console.error('Chyba pÅ™i inicializaci mapy:', error);
    updateStatus('Chyba pÅ™i naÄÃ­tÃ¡nÃ­ mapy: ' + error.message);
  }
}

// NastavenÃ­ reÅ¾imu kreslenÃ­
function setMode(mode) {
  console.log('Setting mode to:', mode);
  
  // VyÄistÃ­ pÅ™edchozÃ­ kreslenÃ­
  clearMap();
  
  currentMode = mode;
  drawingPoints = [];
  
  console.log('Current mode set to:', currentMode);
  
  // Reset vÅ¡ech tlaÄÃ­tek
  document.querySelectorAll('.tools .btn').forEach(btn => {
    btn.style.background = '#007cba';
  });
  
  // Skryje tlaÄÃ­tko dokonÄit
  document.getElementById('btn-finish').style.display = 'none';
  
  // ZvÃ½raznÃ­ aktivnÃ­ tlaÄÃ­tko
  const activeBtn = document.getElementById('btn-' + mode);
  if (activeBtn) {
    activeBtn.style.background = '#28a745';
  }
  
  // ZmÄ›na kurzoru
  if (map) {
    map.getContainer().style.cursor = 'crosshair';
  }
  
  // SpecifickÃ© instrukce pro rÅ¯znÃ© reÅ¾imy
  if (mode === 'point') {
    updateStatus('ğŸ“ ReÅ¾im BOD: KliknÄ›te na mapu pro oznaÄenÃ­ mÃ­sta.');
  } else if (mode === 'line') {
    updateStatus('â– ReÅ¾im LINIE: Klikejte body pro vytvoÅ™enÃ­ cesty. Pak kliknÄ›te "âœ… DokonÄit".');
    document.getElementById('btn-finish').style.display = 'inline-block';
  } else if (mode === 'polygon') {
    updateStatus('ğŸ”· ReÅ¾im OBLAST: Klikejte rohy oblasti. Pak kliknÄ›te "âœ… DokonÄit".');
    document.getElementById('btn-finish').style.display = 'inline-block';
  }
}

// KliknutÃ­ na mapu
function onMapClick(e) {
  console.log('Map clicked:', e.latlng, 'Current mode:', currentMode);
  
  if (!currentMode) {
    updateStatus('NejdÅ™Ã­ve vyberte nÃ¡stroj kreslenÃ­!');
    return;
  }
  
  if (currentMode === 'point') {
    // SmaÅ¾e pÅ™edchozÃ­ marker
    if (currentMarker) {
      map.removeLayer(currentMarker);
    }
    
    // VytvoÅ™Ã­ novÃ½ marker
    currentMarker = L.marker([e.latlng.lat, e.latlng.lng]).addTo(map);
    
    // UloÅ¾Ã­ data
    markerData = {
      type: 'point',
      coordinates: [e.latlng.lat, e.latlng.lng]
    };
    
    // Aktivuje tlaÄÃ­tko generovÃ¡nÃ­
    document.getElementById('btn-generate').disabled = false;
    
    // ZobrazÃ­ souÅ™adnice
    document.getElementById('coordinates').innerHTML = 
      `ğŸ“ SouÅ™adnice: ${e.latlng.lat.toFixed(6)}, ${e.latlng.lng.toFixed(6)}`;
    
    // ZÃ­skÃ¡ adresu
    getAddress(e.latlng.lat, e.latlng.lng);
    
    updateStatus('âœ… Bod oznaÄen! VyplÅˆte formulÃ¡Å™ a vygenerujte .md soubor.');
    
  } else if (currentMode === 'line' || currentMode === 'polygon') {
    console.log('Adding point to drawing:', e.latlng);
    
    // PÅ™idÃ¡ bod do kreslenÃ­
    drawingPoints.push([e.latlng.lat, e.latlng.lng]);
    
    // VytvoÅ™Ã­ doÄasnÃ½ marker pro zobrazenÃ­ bodu
    const marker = L.circleMarker([e.latlng.lat, e.latlng.lng], {
      radius: 5,
      color: '#007cba',
      fillColor: '#007cba',
      fillOpacity: 0.8
    }).addTo(map);
    tempMarkers.push(marker);
    
    console.log('Drawing points now:', drawingPoints.length);
    
    if (currentMode === 'line') {
      // Aktualizuje nebo vytvoÅ™Ã­ linii
      if (currentDrawing) {
        map.removeLayer(currentDrawing);
      }
      currentDrawing = L.polyline(drawingPoints, {color: '#007cba', weight: 3}).addTo(map);
      
      updateStatus(`â– Linie: ${drawingPoints.length} bodÅ¯. PÅ™idejte dalÅ¡Ã­ body nebo kliknÄ›te "âœ… DokonÄit".`);
      
    } else if (currentMode === 'polygon') {
      // Aktualizuje nebo vytvoÅ™Ã­ polygon
      if (currentDrawing) {
        map.removeLayer(currentDrawing);
      }
      if (drawingPoints.length >= 3) {
        currentDrawing = L.polygon(drawingPoints, {
          color: '#007cba',
          weight: 2,
          fillColor: '#007cba',
          fillOpacity: 0.2
        }).addTo(map);
        console.log('Polygon created with', drawingPoints.length, 'points');
      } else {
        console.log('Need at least 3 points for polygon, currently have', drawingPoints.length);
      }
      
      updateStatus(`ğŸ”· Oblast: ${drawingPoints.length} bodÅ¯. PotÅ™ebujete minimÃ¡lnÄ› 3 body. KliknÄ›te "âœ… DokonÄit".`);
    }
    
    // ZobrazÃ­ souÅ™adnice
    document.getElementById('coordinates').innerHTML = 
      `ğŸ“Š PoÄet bodÅ¯: ${drawingPoints.length}<br>SouÅ™adnice: ${JSON.stringify(drawingPoints)}`;
  }
}

// DokonÄenÃ­ kreslenÃ­ linie nebo polygonu
function finishDrawing() {
  if (!currentMode || currentMode === 'point') {
    return;
  }
  
  if (currentMode === 'line' && drawingPoints.length < 2) {
    alert('Linie potÅ™ebuje minimÃ¡lnÄ› 2 body!');
    return;
  }
  
  if (currentMode === 'polygon' && drawingPoints.length < 3) {
    alert('Oblast potÅ™ebuje minimÃ¡lnÄ› 3 body!');
    return;
  }
  
  // UloÅ¾Ã­ data podle typu
  if (currentMode === 'line') {
    markerData = {
      type: 'polyline',
      coordinates: [...drawingPoints]
    };
  } else if (currentMode === 'polygon') {
    markerData = {
      type: 'polygon',
      coordinates: [...drawingPoints]
    };
  }
  
  // Aktivuje tlaÄÃ­tko generovÃ¡nÃ­
  document.getElementById('btn-generate').disabled = false;
  
  // Skryje tlaÄÃ­tko dokonÄit
  document.getElementById('btn-finish').style.display = 'none';
  
  // Resetuje kurzor
  if (map) {
    map.getContainer().style.cursor = '';
  }
  
  // Resetuje reÅ¾im
  currentMode = null;
  
  // ZÃ­skÃ¡ adresu z prvnÃ­ho bodu
  if (drawingPoints.length > 0) {
    getAddress(drawingPoints[0][0], drawingPoints[0][1]);
  }
  
  updateStatus(`âœ… ${markerData.type === 'polyline' ? 'Linie' : 'Oblast'} dokonÄena! VyplÅˆte formulÃ¡Å™ a vygenerujte .md soubor.`);
}

// ZÃ­skÃ¡nÃ­ adresy
async function getAddress(lat, lng) {
  try {
    const response = await fetch(
      `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=cs`
    );
    const data = await response.json();
    if (data.display_name) {
      document.getElementById('address').value = data.display_name;
    }
  } catch (error) {
    console.log('Chyba pÅ™i zÃ­skÃ¡vÃ¡nÃ­ adresy:', error);
  }
}

// SmazÃ¡nÃ­ mapy
function clearMap() {
  if (map) {
    // SmaÅ¾e marker
    if (currentMarker) {
      map.removeLayer(currentMarker);
      currentMarker = null;
    }
    
    // SmaÅ¾e aktuÃ¡lnÃ­ kreslenÃ­
    if (currentDrawing) {
      map.removeLayer(currentDrawing);
      currentDrawing = null;
    }
    
    // SmaÅ¾e doÄasnÃ© markery
    tempMarkers.forEach(marker => {
      if (map.hasLayer(marker)) {
        map.removeLayer(marker);
      }
    });
    tempMarkers = [];
    
    // Resetuje data
    markerData = null;
    drawingPoints = [];
    currentMode = null;
    
    // Reset UI
    document.getElementById('btn-generate').disabled = true;
    document.getElementById('coordinates').innerHTML = '';
    document.getElementById('address').value = '';
    document.getElementById('btn-finish').style.display = 'none';
    
    // Reset tlaÄÃ­tek
    document.querySelectorAll('.tools .btn').forEach(btn => {
      btn.style.background = '#007cba';
    });
    
    // Reset kurzoru
    map.getContainer().style.cursor = '';
    
    updateStatus('Mapa vymazÃ¡na. Vyberte nÃ¡stroj a zaÄnÄ›te znovu.');
  }
}

// Aktualizace statusu
function updateStatus(text) {
  document.getElementById('status').innerHTML = text;
}

// GenerovÃ¡nÃ­ MD souboru
function generateMd() {
  if (!markerData) {
    alert('NejdÅ™Ã­ve oznaÄte mÃ­sto na mapÄ›!');
    return;
  }
  
  const title = document.getElementById('title').value.trim();
  const author = document.getElementById('author').value.trim();
  const category = document.getElementById('category').value;
  const status = document.getElementById('status').value;
  const budget = document.getElementById('budget').value.trim();
  const address = document.getElementById('address').value.trim();
  const description = document.getElementById('description').value.trim();
  
  if (!title || !author || !category || !description) {
    alert('VyplÅˆte vÅ¡echna povinnÃ¡ pole!');
    return;
  }
  
  // Slug pro nÃ¡zev souboru
  const slug = title.toLowerCase()
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g, '')
    .replace(/[^a-z0-9\s]/g, '')
    .replace(/\s+/g, '-');
  
  // GenerovÃ¡nÃ­ markdown
  const markdown = `---
layout: proposal
title: "${title}"
author: "${author}"
category: "${category}"
status: "${status}"
date: ${new Date().toISOString().split('T')[0]}
location:
  type: "${markerData.type}"
  coordinates: ${JSON.stringify(markerData.coordinates)}
  address: "${address}"
${budget ? `budget: "${budget}"` : ''}
excerpt: "${description.split('.')[0]}."
proposal: true
---

# ${title}

${description}

## ZÃ¡kladnÃ­ informace

- **Autor nÃ¡vrhu:** ${author}
- **Kategorie:** ${getCategoryName(category)}
- **Status:** ${getStatusName(status)}
- **Lokace:** ${address || 'OznaÄeno na mapÄ›'}
${budget ? `- **RozpoÄet:** ${budget}` : ''}
- **Datum nÃ¡vrhu:** ${new Date().toLocaleDateString('cs-CZ')}

## TechnickÃ© Ãºdaje

- **Typ oznaÄenÃ­:** ${markerData.type}
- **SouÅ™adnice:** ${JSON.stringify(markerData.coordinates)}
`;
  
  // StaÅ¾enÃ­ souboru s datem pro _posts
  const dateStr = new Date().toISOString().split('T')[0];
  downloadFile(`${dateStr}-${slug}.md`, markdown);
  updateStatus('âœ… Markdown soubor byl staÅ¾en!');
}

// NÃ¡hled
function showPreview() {
  if (!markerData) {
    alert('NejdÅ™Ã­ve oznaÄte mÃ­sto na mapÄ›!');
    return;
  }
  
  const title = document.getElementById('title').value || 'NÃ¡hled nÃ¡vrhu';
  const author = document.getElementById('author').value || 'Autor';
  const description = document.getElementById('description').value || 'Popis';
  
  const preview = `
    <h1>${title}</h1>
    <p><strong>Autor:</strong> ${author}</p>
    <p><strong>SouÅ™adnice:</strong> ${JSON.stringify(markerData.coordinates)}</p>
    <h2>Popis</h2>
    <p>${description}</p>
  `;
  
  const win = window.open('', '_blank', 'width=600,height=400');
  win.document.write(`
    <html>
      <head><title>NÃ¡hled - ${title}</title></head>
      <body style="font-family: Arial; margin: 20px;">
        ${preview}
      </body>
    </html>
  `);
}

// Reset formulÃ¡Å™e
function resetForm() {
  if (confirm('Vymazat vÅ¡echna data?')) {
    document.getElementById('proposal-form').reset();
    clearMap();
    updateStatus('FormulÃ¡Å™ vymazÃ¡n.');
  }
}

// StaÅ¾enÃ­ souboru
function downloadFile(filename, content) {
  const element = document.createElement('a');
  element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(content));
  element.setAttribute('download', filename);
  element.style.display = 'none';
  document.body.appendChild(element);
  element.click();
  document.body.removeChild(element);
}

// PomocnÃ© funkce
function getCategoryName(category) {
  const names = {
    infrastruktura: 'ğŸ—ï¸ Infrastruktura',
    zelen: 'ğŸŒ³ VeÅ™ejnÃ¡ zeleÅˆ',
    doprava: 'ğŸšŒ Doprava',
    sportoviste: 'ğŸ® SportoviÅ¡tÄ›',
    budovy: 'ğŸ¢ VeÅ™ejnÃ© budovy',
    'smart-city': 'ğŸ’¡ Smart city',
    prostredi: 'â™»ï¸ Å½ivotnÃ­ prostÅ™edÃ­'
  };
  return names[category] || category;
}

function getStatusName(status) {
  const names = {
    navrh: 'ğŸ”µ NÃ¡vrh',
    schvaleno: 'ğŸŸ¡ SchvÃ¡leno',
    realizace: 'ğŸŸ£ V realizaci',
    hotovo: 'ğŸŸ¢ Hotovo',
    zamitnuto: 'ğŸ”´ ZamÃ­tnuto'
  };
  return names[status] || status;
}

// Enter pro pÅ™ihlÃ¡Å¡enÃ­
document.addEventListener('keypress', function(e) {
  if (e.key === 'Enter' && document.getElementById('password-screen').style.display !== 'none') {
    login();
  }
});

// Focus na heslo
setTimeout(() => {
  const passwordInput = document.getElementById('password');
  if (passwordInput) passwordInput.focus();
}, 100);
</script>