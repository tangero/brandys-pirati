---
layout: default
title: Editor n√°vrh≈Ø
---

<style>
  .editor-container {
    display: flex;
    height: calc(100vh - 120px);
    gap: 16px;
    margin: 24px 0;
  }
  
  .editor-map {
    flex: 2;
    background: var(--md-sys-color-surface);
    border-radius: 12px;
    overflow: hidden;
    position: relative;
    box-shadow: 0 1px 2px rgba(0,0,0,0.3), 0 1px 3px 1px rgba(0,0,0,0.15);
  }
  
  .editor-form {
    flex: 1;
    background: var(--md-sys-color-surface-variant);
    border-radius: 12px;
    padding: 24px;
    overflow-y: auto;
    box-shadow: 0 1px 2px rgba(0,0,0,0.3), 0 1px 3px 1px rgba(0,0,0,0.15);
  }
  
  .form-group {
    margin-bottom: 20px;
  }
  
  .form-group label {
    display: block;
    margin-bottom: 6px;
    font-weight: 500;
    color: var(--md-sys-color-on-surface);
    font-size: 14px;
  }
  
  .form-group input,
  .form-group select,
  .form-group textarea {
    width: 100%;
    padding: 12px;
    border: 2px solid var(--md-sys-color-outline);
    border-radius: 8px;
    background: var(--md-sys-color-surface);
    color: var(--md-sys-color-on-surface);
    font-size: 14px;
    font-family: inherit;
    box-sizing: border-box;
  }
  
  .form-group textarea {
    min-height: 100px;
    resize: vertical;
  }
  
  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: var(--md-sys-color-primary);
    box-shadow: 0 0 0 1px var(--md-sys-color-primary);
  }
  
  .drawing-tools {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  
  .drawing-tool {
    background: var(--md-sys-color-primary);
    color: var(--md-sys-color-on-primary);
    border: none;
    border-radius: 8px;
    padding: 10px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 500;
    min-width: 120px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    transition: all 0.2s ease;
  }
  
  .drawing-tool:hover:not(:disabled) {
    opacity: 0.9;
    transform: translateY(-1px);
  }
  
  .drawing-tool.active {
    background: var(--md-sys-color-secondary);
    color: var(--md-sys-color-on-secondary);
  }
  
  .drawing-tool:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  
  .map-info {
    position: absolute;
    bottom: 10px;
    left: 10px;
    right: 10px;
    background: rgba(255, 255, 255, 0.95);
    padding: 12px;
    border-radius: 8px;
    font-size: 13px;
    color: #333;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  .coordinates-display {
    font-family: monospace;
    background: #f5f5f5;
    padding: 8px;
    border-radius: 4px;
    margin-top: 8px;
    max-height: 100px;
    overflow-y: auto;
  }
  
  .action-buttons {
    display: flex;
    gap: 12px;
    margin-top: 24px;
  }
  
  .btn {
    padding: 12px 24px;
    border-radius: 8px;
    border: none;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 14px;
  }
  
  .btn-primary {
    background: var(--md-sys-color-primary);
    color: var(--md-sys-color-on-primary);
  }
  
  .btn-secondary {
    background: var(--md-sys-color-secondary);
    color: var(--md-sys-color-on-secondary);
  }
  
  .btn-danger {
    background: #F44336;
    color: white;
  }
  
  .btn:hover:not(:disabled) {
    opacity: 0.9;
    transform: translateY(-1px);
  }
  
  .btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  
  .password-check {
    background: var(--md-sys-color-error-container);
    color: var(--md-sys-color-on-error-container);
    padding: 16px;
    border-radius: 8px;
    margin-bottom: 24px;
    text-align: center;
  }
  
  .success-message {
    background: var(--md-sys-color-primary-container);
    color: var(--md-sys-color-on-primary-container);
    padding: 16px;
    border-radius: 8px;
    margin-bottom: 24px;
  }
  
  #map {
    height: 100%;
    width: 100%;
  }
  
  @media (max-width: 768px) {
    .editor-container {
      flex-direction: column;
      height: auto;
    }
    
    .editor-form {
      order: -1;
    }
    
    .editor-map {
      height: 60vh;
    }
  }
</style>

<div class="md-section">
  <div class="md-section__header">
    <h1 class="md-section__title">Editor n√°vrh≈Ø</h1>
    <p class="md-section__subtitle">Vytvo≈ôte nov√Ω n√°vrh oznaƒçen√≠m na mapƒõ a vyplnƒõn√≠m formul√°≈ôe</p>
  </div>
  
  <div id="access-form" class="password-check">
    <h3>P≈ô√≠stup do editoru</h3>
    <input type="password" id="password-input" placeholder="Zadejte heslo" style="margin: 10px; padding: 8px;">
    <button onclick="checkAccess()" class="btn btn-primary">P≈ôihl√°sit</button>
    <p style="margin-top: 10px; font-size: 12px;">Pro p≈ô√≠stup do editoru je nutn√© heslo.</p>
  </div>
  
  <div id="editor-content" style="display: none;">
    <div class="editor-container">
      <div class="editor-map">
        <div class="drawing-tools">
          <button class="drawing-tool" onclick="startDrawing('marker')" id="btn-marker">
            üìç Bod (m√≠sto)
          </button>
          <button class="drawing-tool" onclick="startDrawing('polyline')" id="btn-polyline">
            ‚ûñ Linie (cesta)
          </button>
          <button class="drawing-tool" onclick="startDrawing('polygon')" id="btn-polygon">
            üî∑ Oblast (plocha)
          </button>
          <button class="drawing-tool" onclick="clearDrawing()" id="btn-clear">
            üóëÔ∏è Smazat
          </button>
          <button class="drawing-tool" onclick="fitToBrandys()" id="btn-center">
            üéØ Brand√Ωs
          </button>
        </div>
        
        <div id="map"></div>
        
        <div class="map-info">
          <div><strong>N√°vod:</strong></div>
          <div>1. Vyberte n√°stroj pro kreslen√≠</div>
          <div>2. Kliknƒõte na mapu pro oznaƒçen√≠ m√≠sta</div>
          <div>3. Vypl≈àte formul√°≈ô vpravo</div>
          <div id="coordinates-info" class="coordinates-display" style="display: none;"></div>
        </div>
      </div>
      
      <div class="editor-form">
        <form id="proposal-form">
          <div class="form-group">
            <label for="proposal-title">N√°zev n√°vrhu *</label>
            <input type="text" id="proposal-title" required placeholder="Nap≈ô. Nov√© dƒõtsk√© h≈ôi≈°tƒõ">
          </div>
          
          <div class="form-group">
            <label for="proposal-author">Autor n√°vrhu *</label>
            <input type="text" id="proposal-author" required placeholder="Va≈°e jm√©no">
          </div>
          
          <div class="form-group">
            <label for="proposal-category">Kategorie *</label>
            <select id="proposal-category" required>
              <option value="">Vyberte kategorii</option>
              <option value="infrastruktura">üèóÔ∏è Infrastruktura</option>
              <option value="zelen">üå≥ Ve≈ôejn√° zele≈à</option>
              <option value="doprava">üöå Doprava</option>
              <option value="sportoviste">üéÆ Sportovi≈°tƒõ</option>
              <option value="budovy">üè¢ Ve≈ôejn√© budovy</option>
              <option value="smart-city">üí° Smart city</option>
              <option value="prostredi">‚ôªÔ∏è ≈Ωivotn√≠ prost≈ôed√≠</option>
              <option value="developerske">üèòÔ∏è Developersk√© projekty</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="proposal-status">Status</label>
            <select id="proposal-status">
              <option value="navrh">üîµ N√°vrh</option>
              <option value="schvaleno">üü° Schv√°leno</option>
              <option value="realizace">üü£ V realizaci</option>
              <option value="hotovo">üü¢ Hotovo</option>
              <option value="zamitnuto">üî¥ Zam√≠tnuto</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="proposal-budget">Rozpoƒçet</label>
            <input type="text" id="proposal-budget" placeholder="Nap≈ô. 2.5M Kƒç">
          </div>
          
          <div class="form-group">
            <label for="proposal-address">Adresa/Lokace</label>
            <input type="text" id="proposal-address" placeholder="Automaticky se dopln√≠ podle mapy">
          </div>
          
          <div class="form-group">
            <label for="proposal-description">Popis n√°vrhu *</label>
            <textarea id="proposal-description" required placeholder="Detailn√≠ popis n√°vrhu, jeho p≈ô√≠nos≈Ø a od≈Øvodnƒõn√≠..."></textarea>
          </div>
          
          <div class="action-buttons">
            <button type="button" onclick="console.log('Generate clicked'); generateMarkdown()" class="btn btn-primary" id="btn-generate" disabled>
              üíæ Vygenerovat .md soubor
            </button>
            <button type="button" onclick="console.log('Preview clicked'); previewProposal()" class="btn btn-secondary" id="btn-preview" disabled>
              üëÅÔ∏è N√°hled
            </button>
            <button type="reset" onclick="console.log('Reset clicked'); resetForm()" class="btn btn-danger">
              üîÑ Vymazat v≈°e
            </button>
          </div>
          
          <div style="margin-top: 20px; padding: 10px; background: #f0f0f0; border-radius: 5px; font-size: 12px;">
            <strong>Debug:</strong>
            <div id="debug-info">Oznaƒçte m√≠sto na mapƒõ pro aktivaci tlaƒç√≠tek</div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Leaflet CSS a JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// Glob√°ln√≠ promƒõnn√©
let map;
let drawnItems;
let currentDrawing = null;
let drawingMode = null;

// Heslo pro p≈ô√≠stup
const ADMIN_PASSWORD = "brandys2025";

// Kontrola p≈ô√≠stupu
function checkAccess() {
  const password = document.getElementById('password-input').value;
  if (password === ADMIN_PASSWORD) {
    document.getElementById('access-form').style.display = 'none';
    document.getElementById('editor-content').style.display = 'block';
    initMap();
  } else {
    alert('Nespr√°vn√© heslo!');
  }
}

// Inicializace mapy
function initMap() {
  // Kontrola zda je Leaflet naƒçten
  if (typeof L === 'undefined') {
    console.error('Leaflet nen√≠ naƒçten!');
    setTimeout(initMap, 100); // Zkus√≠ znovu za 100ms
    return;
  }
  
  console.log('Initializing map...');
  const brandysCenter = [50.1872, 14.6634];
  
  try {
    map = L.map('map').setView(brandysCenter, 15);
    
    // Z√°kladn√≠ vrstvy
    const streetMap = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap contributors',
      maxZoom: 19
    }).addTo(map);

    // Ortofoto z ƒå√öZK
    const orthophoto = L.tileLayer.wms('https://geoportal.cuzk.cz/WMS_ORTOFOTO_PUB/WMService.aspx', {
      layers: 'GR_ORTFOTORGB',
      format: 'image/png',
      transparent: false,
      attribution: '¬© ƒå√öZK - ortofoto',
      maxZoom: 18
    });

    // P≈ôekryvn√© vrstvy
    
    // √özemn√≠ pl√°n - hlavn√≠ v√Ωkres
    const uzemniPlan = L.tileLayer.wms('https://gis.kr-stredocesky.cz/wagisas01/services/USR/USR_UPN_UPD_OBEC_HLV/MapServer/WMSServer', {
      layers: '0,1,2,3,4,5,6,7,8,9',
      format: 'image/png',
      transparent: true,
      attribution: '¬© St≈ôedoƒçesk√Ω kraj - √∫zemn√≠ pl√°ny',
      opacity: 0.6,
      maxZoom: 20
    });

    // Z√°sady √∫zemn√≠ho rozvoje (koridory komunikac√≠)
    const zur = L.tileLayer.wms('https://gis.kr-stredocesky.cz/wagisas01/services/USR/USR_UPN_UPD_KRAJ_ZUR_UZ_11_2023/MapServer/WMSServer', {
      layers: '0,1,2,3,4,5',
      format: 'image/png',
      transparent: true,
      attribution: '¬© St≈ôedoƒçesk√Ω kraj - Z√öR',
      opacity: 0.5,
      maxZoom: 20
    });
    
    // Layer control
    const baseLayers = {
      "Uliƒçn√≠ mapa": streetMap,
      "Ortofoto": orthophoto
    };
    
    const overlayLayers = {
      "üìã √özemn√≠ pl√°n": uzemniPlan,
      "üõ£Ô∏è Pl√°novan√© komunikace (Z√öR)": zur
    };
    
    L.control.layers(baseLayers, overlayLayers).addTo(map);
    
    // Vrstva pro kreslen√≠
    drawnItems = new L.FeatureGroup();
    map.addLayer(drawnItems);
    
    // Event listenery
    map.on('click', onMapClick);
    
    // Event listenery pro dvojklik
    map.on('dblclick', function(e) {
      console.log('Double click detected, drawing mode:', drawingMode);
      
      if (drawingMode === 'polyline' && currentDrawing) {
        const coords = currentDrawing.getLatLngs().map(ll => [ll.lat, ll.lng]);
        console.log('Completing polyline with coords:', coords);
        onDrawingComplete('polyline', coords);
        drawingMode = null;
        clearActiveButtons();
        map.getContainer().style.cursor = '';
        updateMapInfo('Linie dokonƒçena. Vypl≈àte formul√°≈ô.');
        
      } else if (drawingMode === 'polygon' && currentDrawing) {
        const coords = currentDrawing.getLatLngs()[0].map(ll => [ll.lat, ll.lng]);
        console.log('Completing polygon with coords:', coords);
        onDrawingComplete('polygon', coords);
        drawingMode = null;
        clearActiveButtons();
        map.getContainer().style.cursor = '';
        updateMapInfo('Oblast dokonƒçena. Vypl≈àte formul√°≈ô.');
      }
    });
    
    console.log('Map initialized successfully');
    
  } catch (error) {
    console.error('Chyba p≈ôi inicializaci mapy:', error);
    document.getElementById('map').innerHTML = '<div style="padding: 20px; text-align: center; color: red;">Chyba p≈ôi naƒç√≠t√°n√≠ mapy. Zkuste obnovit str√°nku.</div>';
  }
}

// Zah√°jen√≠ kreslen√≠
function startDrawing(type) {
  console.log('Starting drawing:', type);
  drawingMode = type;
  clearActiveButtons();
  document.getElementById(`btn-${type}`).classList.add('active');
  
  if (type === 'marker') {
    map.getContainer().style.cursor = 'crosshair';
    updateMapInfo('Kliknƒõte na mapu pro oznaƒçen√≠ bodu');
  } else if (type === 'polyline') {
    map.getContainer().style.cursor = 'crosshair';
    updateMapInfo('Kliknƒõte pro zaƒç√°tek linie, pak dal≈°√≠ body. Dvojklik pro dokonƒçen√≠.');
    currentDrawing = L.polyline([], {color: '#2196F3', weight: 4});
    currentDrawing.addTo(drawnItems);
    console.log('Polyline created');
  } else if (type === 'polygon') {
    map.getContainer().style.cursor = 'crosshair';
    updateMapInfo('Kliknƒõte pro rohov√© body oblasti. Dvojklik pro dokonƒçen√≠.');
    currentDrawing = L.polygon([], {color: '#2196F3', weight: 2, fillOpacity: 0.3});
    currentDrawing.addTo(drawnItems);
    console.log('Polygon created');
  }
}

// Klik na mapu
function onMapClick(e) {
  console.log('Map clicked:', e.latlng, 'Drawing mode:', drawingMode);
  
  if (!drawingMode) {
    console.log('No drawing mode selected');
    return;
  }
  
  if (drawingMode === 'marker') {
    console.log('Creating marker');
    clearDrawing();
    const marker = L.marker(e.latlng, {
      icon: L.divIcon({
        className: 'custom-marker',
        html: '<div style="background: #2196F3; width: 20px; height: 20px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>',
        iconSize: [20, 20],
        iconAnchor: [10, 10]
      })
    });
    marker.addTo(drawnItems);
    
    onDrawingComplete('point', [e.latlng.lat, e.latlng.lng]);
    getAddressFromCoords(e.latlng.lat, e.latlng.lng);
    
  } else if (drawingMode === 'polyline' && currentDrawing) {
    console.log('Adding point to polyline');
    currentDrawing.addLatLng(e.latlng);
    updateCoordinatesDisplay();
    
  } else if (drawingMode === 'polygon' && currentDrawing) {
    console.log('Adding point to polygon');
    currentDrawing.addLatLng(e.latlng);
    updateCoordinatesDisplay();
  }
}


// Dokonƒçen√≠ kreslen√≠
function onDrawingComplete(type, coordinates) {
  console.log('Drawing completed:', type, coordinates);
  
  document.getElementById('btn-generate').disabled = false;
  document.getElementById('btn-preview').disabled = false;
  
  const form = document.getElementById('proposal-form');
  form.dataset.locationType = type;
  form.dataset.locationCoords = JSON.stringify(coordinates);
  
  // Update debug info
  const debugEl = document.getElementById('debug-info');
  if (debugEl) {
    debugEl.innerHTML = `Typ: ${type}<br>Sou≈ôadnice: ${JSON.stringify(coordinates)}<br>Tlaƒç√≠tka aktivov√°na!`;
  }
  
  updateCoordinatesDisplay();
}

// Aktualizace zobrazen√≠ sou≈ôadnic
function updateCoordinatesDisplay() {
  const coordsEl = document.getElementById('coordinates-info');
  const form = document.getElementById('proposal-form');
  
  if (form.dataset.locationCoords) {
    const coords = JSON.parse(form.dataset.locationCoords);
    const type = form.dataset.locationType;
    
    coordsEl.style.display = 'block';
    coordsEl.innerHTML = `<strong>Typ:</strong> ${type}<br><strong>Sou≈ôadnice:</strong><br>${JSON.stringify(coords, null, 2)}`;
  }
}

// Smaz√°n√≠ kreslen√≠
function clearDrawing() {
  drawnItems.clearLayers();
  currentDrawing = null;
  drawingMode = null;
  clearActiveButtons();
  map.getContainer().style.cursor = '';
  
  const form = document.getElementById('proposal-form');
  delete form.dataset.locationType;
  delete form.dataset.locationCoords;
  
  document.getElementById('btn-generate').disabled = true;
  document.getElementById('btn-preview').disabled = true;
  document.getElementById('coordinates-info').style.display = 'none';
  
  updateMapInfo('Kreslen√≠ smaz√°no. Zaƒçnƒõte znovu v√Ωbƒõrem n√°stroje.');
}

// Vymaz√°n√≠ aktivn√≠ch tlaƒç√≠tek
function clearActiveButtons() {
  document.querySelectorAll('.drawing-tool').forEach(btn => {
    btn.classList.remove('active');
  });
}

// Aktualizace informac√≠ na mapƒõ
function updateMapInfo(text) {
  const infoEl = document.querySelector('.map-info div');
  if (infoEl) {
    infoEl.innerHTML = `<strong>Status:</strong> ${text}`;
  }
}

// P≈ôibl√≠≈æen√≠ na Brand√Ωs
function fitToBrandys() {
  map.setView([50.1872, 14.6634], 15);
}

// Z√≠sk√°n√≠ adresy ze sou≈ôadnic
async function getAddressFromCoords(lat, lng) {
  try {
    const response = await fetch(
      `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=cs`
    );
    const data = await response.json();
    if (data.display_name) {
      document.getElementById('proposal-address').value = data.display_name;
    }
  } catch (error) {
    console.log('Chyba p≈ôi z√≠sk√°v√°n√≠ adresy:', error);
  }
}

// Generov√°n√≠ Markdown souboru
function generateMarkdown() {
  const form = document.getElementById('proposal-form');
  
  // Validace m√≠sta na mapƒõ
  if (!form.dataset.locationCoords) {
    alert('Nejd≈ô√≠ve oznaƒçte m√≠sto na mapƒõ!');
    return;
  }
  
  // Z√≠sk√°n√≠ dat z formul√°≈ôe
  const title = document.getElementById('proposal-title').value.trim();
  const author = document.getElementById('proposal-author').value.trim();
  const category = document.getElementById('proposal-category').value;
  const status = document.getElementById('proposal-status').value;
  const budget = document.getElementById('proposal-budget').value.trim();
  const address = document.getElementById('proposal-address').value.trim();
  const description = document.getElementById('proposal-description').value.trim();
  
  // Validace povinn√Ωch pol√≠
  if (!title) {
    alert('Vypl≈àte n√°zev n√°vrhu!');
    return;
  }
  if (!author) {
    alert('Vypl≈àte autora n√°vrhu!');
    return;
  }
  if (!category) {
    alert('Vyberte kategorii!');
    return;
  }
  if (!description) {
    alert('Vypl≈àte popis n√°vrhu!');
    return;
  }
  
  const locationType = form.dataset.locationType;
  const coordinates = JSON.parse(form.dataset.locationCoords);
  
  // Vytvo≈ôen√≠ slug
  const slug = title.toLowerCase()
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g, '')
    .replace(/[^a-z0-9\s]/g, '')
    .replace(/\s+/g, '-');
  
  // Generov√°n√≠ Markdown
  const markdown = `---
layout: proposal
title: "${title}"
author: "${author}"
category: "${category}"
status: "${status}"
date: ${new Date().toISOString().split('T')[0]}
location:
  type: "${locationType}"
  coordinates: ${JSON.stringify(coordinates)}
  address: "${address}"
${budget ? `budget: "${budget}"` : ''}
excerpt: "${description.split('.')[0]}"
proposal: true
---

# ${title}

${description}

## Z√°kladn√≠ informace

- **Autor n√°vrhu:** ${author}
- **Kategorie:** ${getCategoryName(category)}
- **Status:** ${getStatusName(status)}
- **Lokace:** ${address || 'Oznaƒçeno na mapƒõ'}
${budget ? `- **Rozpoƒçet:** ${budget}` : ''}
- **Datum n√°vrhu:** ${new Date().toLocaleDateString('cs-CZ')}

## Technick√© √∫daje

- **Typ oznaƒçen√≠:** ${locationType}
- **Sou≈ôadnice:** ${JSON.stringify(coordinates)}
`;
  
  // Sta≈æen√≠ souboru s datem pro _posts/proposals
  const dateStr = new Date().toISOString().split('T')[0];
  downloadFile(`${dateStr}-${slug}.md`, markdown);
  
  // Zobrazen√≠ zpr√°vy
  showSuccessMessage('Markdown soubor byl vygenerov√°n a sta≈æen!');
}

// N√°hled n√°vrhu
function previewProposal() {
  const form = document.getElementById('proposal-form');
  
  if (!form.dataset.locationCoords) {
    alert('Nejd≈ô√≠ve oznaƒçte m√≠sto na mapƒõ!');
    return;
  }
  
  const title = document.getElementById('proposal-title').value.trim() || 'N√°hled n√°vrhu';
  const author = document.getElementById('proposal-author').value.trim() || 'Nezn√°m√Ω autor';
  const category = document.getElementById('proposal-category').value;
  const status = document.getElementById('proposal-status').value;
  const budget = document.getElementById('proposal-budget').value.trim();
  const address = document.getElementById('proposal-address').value.trim();
  const description = document.getElementById('proposal-description').value.trim() || 'Popis nebyl vyplnƒõn';
  
  const previewWindow = window.open('', '_blank', 'width=600,height=800');
  previewWindow.document.write(`
    <html>
      <head>
        <title>N√°hled n√°vrhu</title>
        <style>
          body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; margin: 40px; line-height: 1.6; }
          .header { border-bottom: 2px solid #eee; padding-bottom: 20px; margin-bottom: 30px; }
          .meta { background: #f5f5f5; padding: 15px; border-radius: 8px; margin: 20px 0; }
          .status { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; }
          .status-navrh { background: #e3f2fd; color: #1976d2; }
        </style>
      </head>
      <body>
        <div class="header">
          <h1>${title}</h1>
          <p><strong>Autor:</strong> ${author}</p>
          <span class="status status-${status}">${getStatusName(status)}</span>
        </div>
        <div class="meta">
          <p><strong>Kategorie:</strong> ${getCategoryName(category)}</p>
          <p><strong>Typ oznaƒçen√≠:</strong> ${form.dataset.locationType}</p>
          <p><strong>Datum:</strong> ${new Date().toLocaleDateString('cs-CZ')}</p>
          ${budget ? `<p><strong>Rozpoƒçet:</strong> ${budget}</p>` : ''}
          ${address ? `<p><strong>Adresa:</strong> ${address}</p>` : ''}
        </div>
        <div class="content">
          <h2>Popis</h2>
          <p>${description.replace(/\n/g, '<br>')}</p>
        </div>
        <div style="margin-top: 30px; padding: 15px; background: #f0f0f0; border-radius: 5px;">
          <h3>Debug informace</h3>
          <p><strong>Sou≈ôadnice:</strong> ${form.dataset.locationCoords || 'Neoznaƒçeno'}</p>
        </div>
      </body>
    </html>
  `);
}

// Reset formul√°≈ôe
function resetForm() {
  if (confirm('Opravdu chcete vymazat v≈°echna data?')) {
    document.getElementById('proposal-form').reset();
    clearDrawing();
    updateMapInfo('Formul√°≈ô vymaz√°n. Zaƒçnƒõte znovu.');
  }
}

// Sta≈æen√≠ souboru
function downloadFile(filename, content) {
  const element = document.createElement('a');
  element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(content));
  element.setAttribute('download', filename);
  element.style.display = 'none';
  document.body.appendChild(element);
  element.click();
  document.body.removeChild(element);
}

// Zobrazen√≠ zpr√°vy o √∫spƒõchu
function showSuccessMessage(message) {
  const existingMessage = document.querySelector('.success-message');
  if (existingMessage) {
    existingMessage.remove();
  }
  
  const messageEl = document.createElement('div');
  messageEl.className = 'success-message';
  messageEl.textContent = message;
  
  const form = document.querySelector('.editor-form');
  form.insertBefore(messageEl, form.firstChild);
  
  setTimeout(() => {
    messageEl.remove();
  }, 5000);
}

// Pomocn√© funkce
function getCategoryName(category) {
  const names = {
    infrastruktura: 'üèóÔ∏è Infrastruktura',
    zelen: 'üå≥ Ve≈ôejn√° zele≈à',
    doprava: 'üöå Doprava',
    sportoviste: 'üéÆ Sportovi≈°tƒõ',
    budovy: 'üè¢ Ve≈ôejn√© budovy',
    'smart-city': 'üí° Smart city',
    prostredi: '‚ôªÔ∏è ≈Ωivotn√≠ prost≈ôed√≠',
    developerske: 'üèòÔ∏è Developersk√© projekty'
  };
  return names[category] || category;
}

function getStatusName(status) {
  const names = {
    navrh: 'üîµ N√°vrh',
    schvaleno: 'üü° Schv√°leno',
    realizace: 'üü£ V realizaci',
    hotovo: 'üü¢ Hotovo',
    zamitnuto: 'üî¥ Zam√≠tnuto'
  };
  return names[status] || status;
}

// Enter pro p≈ôihl√°≈°en√≠ a kontrola naƒçten√≠ knihoven
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM loaded');
  
  // Kontrola naƒçten√≠ Leaflet
  if (typeof L === 'undefined') {
    console.log('Leaflet nen√≠ je≈°tƒõ naƒçten, ƒçek√°m...');
  } else {
    console.log('Leaflet je naƒçten');
  }
  
  const passwordInput = document.getElementById('password-input');
  if (passwordInput) {
    passwordInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        checkAccess();
      }
    });
  }
  
  // Focus na heslo
  if (passwordInput) {
    passwordInput.focus();
  }
});
</script>