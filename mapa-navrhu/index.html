---
layout: default
title: Mapa n√°vrh≈Ø
---

<style>
  .map-container {
    display: flex;
    height: calc(100vh - 120px);
    gap: 16px;
    margin: 24px 0;
  }
  
  .map-panel {
    flex: 1;
    background: var(--md-sys-color-surface);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 1px 2px rgba(0,0,0,0.3), 0 1px 3px 1px rgba(0,0,0,0.15);
  }
  
  .sidebar {
    width: 320px;
    background: var(--md-sys-color-surface-variant);
    border-radius: 12px;
    padding: 20px;
    overflow-y: auto;
    box-shadow: 0 1px 2px rgba(0,0,0,0.3), 0 1px 3px 1px rgba(0,0,0,0.15);
  }
  
  .sidebar h3 {
    margin: 0 0 16px;
    color: var(--md-sys-color-on-surface);
    font-size: 18px;
    font-weight: 500;
  }
  
  .filter-section {
    margin-bottom: 24px;
  }
  
  .filter-section label {
    display: block;
    margin-bottom: 8px;
    font-size: 14px;
    font-weight: 500;
    color: var(--md-sys-color-on-surface-variant);
  }
  
  .filter-section select,
  .filter-section input {
    width: 100%;
    padding: 12px;
    border: 1px solid var(--md-sys-color-outline);
    border-radius: 8px;
    background: var(--md-sys-color-surface);
    color: var(--md-sys-color-on-surface);
    font-size: 14px;
  }
  
  .filter-section select:focus,
  .filter-section input:focus {
    outline: 2px solid var(--md-sys-color-primary);
    border-color: var(--md-sys-color-primary);
  }
  
  .proposal-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  
  .proposal-card {
    background: var(--md-sys-color-surface);
    border-radius: 8px;
    padding: 16px;
    border-left: 4px solid var(--md-sys-color-primary);
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .proposal-card:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }
  
  .proposal-card.status-navrh { border-left-color: #2196F3; }
  .proposal-card.status-schvaleno { border-left-color: #FF9800; }
  .proposal-card.status-realizace { border-left-color: #9C27B0; }
  .proposal-card.status-hotovo { border-left-color: #4CAF50; }
  .proposal-card.status-zamitnuto { border-left-color: #F44336; }
  
  .proposal-title {
    font-weight: 500;
    margin-bottom: 4px;
    color: var(--md-sys-color-on-surface);
  }
  
  .proposal-meta {
    font-size: 12px;
    color: var(--md-sys-color-on-surface-variant);
    display: flex;
    gap: 8px;
    margin-bottom: 8px;
  }
  
  .proposal-status {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 500;
    text-transform: uppercase;
  }
  
  .proposal-status.status-navrh { background: #E3F2FD; color: #1976D2; }
  .proposal-status.status-schvaleno { background: #FFF3E0; color: #F57C00; }
  .proposal-status.status-realizace { background: #F3E5F5; color: #7B1FA2; }
  .proposal-status.status-hotovo { background: #E8F5E8; color: #388E3C; }
  .proposal-status.status-zamitnuto { background: #FFEBEE; color: #D32F2F; }
  
  .map-controls {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  
  .map-control-btn {
    background: var(--md-sys-color-primary);
    color: var(--md-sys-color-on-primary);
    border: none;
    border-radius: 8px;
    padding: 10px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 500;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    transition: all 0.2s ease;
  }
  
  .map-control-btn:hover {
    background: var(--md-sys-color-primary);
    opacity: 0.9;
    transform: translateY(-1px);
  }
  
  #map {
    height: 100%;
    width: 100%;
  }
  
  @media (max-width: 768px) {
    .map-container {
      flex-direction: column;
      height: auto;
    }
    
    .sidebar {
      width: 100%;
      order: -1;
    }
    
    .map-panel {
      height: 60vh;
    }
  }
</style>

<div class="md-section">
  <div class="md-section__header">
    <h1 class="md-section__title">Mapa n√°vrh≈Ø</h1>
    <p class="md-section__subtitle">Interaktivn√≠ mapa s n√°vrhy zmƒõn a √∫prav ve mƒõstƒõ</p>
  </div>
  
  <div class="map-container">
    <div class="map-panel">
      <div id="map"></div>
    </div>
    
    <div class="sidebar">
      <h3>Filtry</h3>
      
      <div class="filter-section">
        <label for="filter-location">Oblast:</label>
        <select id="filter-location" onchange="zoomToArea(this.value)">
          <option value="">Vyberte oblast</option>
          <option value="brandys">üèõÔ∏è Brand√Ωs</option>
          <option value="boleslav">‚õ™ Star√° Boleslav</option>
          <option value="kralovice">üè° Kr√°lovice</option>
          <option value="vrabi">üåæ Vr√°b√≠</option>
          <option value="popovice">üå≥ Popovice</option>
          <option value="sidliste">üè¢ S√≠dli≈°tƒõ Brand√Ωs</option>
        </select>
      </div>
      
      <div class="filter-section">
        <label for="filter-category">Kategorie:</label>
        <select id="filter-category" onchange="filterProposals()">
          <option value="">V≈°echny kategorie</option>
          <option value="infrastruktura">üèóÔ∏è Infrastruktura</option>
          <option value="zelen">üå≥ Ve≈ôejn√° zele≈à</option>
          <option value="doprava">üöå Doprava</option>
          <option value="sportoviste">üéÆ Sportovi≈°tƒõ</option>
          <option value="budovy">üè¢ Ve≈ôejn√© budovy</option>
          <option value="smart-city">üí° Smart city</option>
          <option value="prostredi">‚ôªÔ∏è ≈Ωivotn√≠ prost≈ôed√≠</option>
          <option value="developerske">üèòÔ∏è Developersk√© projekty</option>
        </select>
      </div>
      
      <div class="filter-section">
        <label for="filter-search">Vyhledat:</label>
        <input type="text" id="filter-search" placeholder="N√°zev, autor, popis..." oninput="filterProposals()">
      </div>
      
      <h3>N√°vrhy (<span id="proposals-count">0</span>)</h3>
      <div id="proposals-list" class="proposal-list">
        <!-- N√°vrhy se naƒçtou dynamicky -->
      </div>
    </div>
  </div>
</div>

<!-- Leaflet CSS a JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// Glob√°ln√≠ promƒõnn√©
let map;
let cadastralLayer;
let proposalsLayer;
let allProposals = [];
let activeFilters = {
  category: '',
  search: ''
};

// Inicializace mapy
function initMap() {
  // St≈ôed Brand√Ωsa nad Labem-Star√© Boleslavi
  const brandysCenter = [50.1872, 14.6634];
  
  map = L.map('map').setView(brandysCenter, 14);
  
  // Vytvo≈ôen√≠ vrstev pro n√°vrhy
  proposalsLayer = L.layerGroup().addTo(map);
  
  // Naƒçten√≠ dat
  setupBaseLayers();
  loadProposalsData();
}

// P≈ôid√°n√≠ layer control s v√Ωbƒõrem map
function setupBaseLayers() {
  // Z√°kladn√≠ vrstvy
  const streetMap = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap contributors',
    maxZoom: 19
  });

  // Ortofoto z ƒå√öZK
  const orthophoto = L.tileLayer.wms('https://geoportal.cuzk.cz/WMS_ORTOFOTO_PUB/WMService.aspx', {
    layers: 'GR_ORTFOTORGB',
    format: 'image/png',
    transparent: false,
    attribution: '¬© ƒå√öZK - ortofoto',
    maxZoom: 18
  });

  // V√Ωchoz√≠ mapa
  streetMap.addTo(map);
  
  // Layer control
  const baseLayers = {
    "Uliƒçn√≠ mapa": streetMap,
    "Ortofoto": orthophoto
  };
  
  L.control.layers(baseLayers).addTo(map);
}

// Naƒçten√≠ dat n√°vrh≈Ø z Jekyll kolekce
async function loadProposalsData() {
  console.log('Naƒç√≠t√°m data n√°vrh≈Ø z Jekyll API...');
  
  try {
    // Naƒçten√≠ dat z JSON API
    const response = await fetch('{{ "/api/proposals.json" | relative_url }}');
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const data = await response.json();
    
    console.log('Naƒçten√° data z API:', data);
    console.log('Poƒçet n√°vrh≈Ø:', data.count);
    console.log('Dostupn√© kolekce:', data.debug.collections_available);
    
    if (data.count === 0) {
      // ≈Ω√°dn√° data z Jekyll kolekce - hl√°s√≠me chybu
      console.error('CHYBA: ≈Ω√°dn√© n√°vrhy nebyly naƒçteny z Jekyll kolekce _proposals');
      console.error('Debug info:', data.debug);
      
      // Zobraz√≠me chybovou zpr√°vu u≈æivateli
      const listEl = document.getElementById('proposals-list');
      const countEl = document.getElementById('proposals-count');
      
      if (listEl) {
        listEl.innerHTML = `
          <div style="text-align: center; padding: 40px; color: #d32f2f; background: #ffebee; border-radius: 8px; margin: 20px 0;">
            <h3 style="margin: 0 0 16px 0;">‚ö†Ô∏è Chyba p≈ôi naƒç√≠t√°n√≠ n√°vrh≈Ø</h3>
            <p style="margin: 0;">Nepoda≈ôilo se naƒç√≠st n√°vrhy z Jekyll kolekce. Kontaktujte spr√°vce webu.</p>
            <details style="margin-top: 16px; text-align: left;">
              <summary style="cursor: pointer; font-weight: bold;">Technick√© informace</summary>
              <p style="font-family: monospace; font-size: 12px; background: #f5f5f5; padding: 8px; border-radius: 4px; margin-top: 8px;">
                Jekyll kolekce '_proposals' je pr√°zdn√° nebo se nepoda≈ôila zpracovat.<br>
                Poƒçet n√°vrh≈Ø: ${data.count}<br>
                Dostupn√© kolekce: ${data.debug.collections_available.join(', ')}<br>
                Prvn√≠ n√°vrh: ${data.debug.proposals_path || '≈æ√°dn√Ω'}<br><br>
                Zkontrolujte:<br>
                1. Existuj√≠ soubory v adres√°≈ôi _proposals/<br>
                2. Jekyll server spr√°vnƒõ zpracov√°v√° kolekci<br>
                3. Soubory maj√≠ spr√°vnou YAML strukturu
              </p>
            </details>
          </div>
        `;
      }
      
      if (countEl) {
        countEl.textContent = '0';
      }
      
      // Ukonƒç√≠me funkci - ≈æ√°dn√© fallback data
      return;
    }
    
    // Zpracujeme naƒçten√° data
    allProposals = data.proposals.map(proposal => {
      // Zajist√≠me spr√°vn√Ω form√°t dat
      return {
        ...proposal,
        // P≈ôevedeme status na spr√°vn√Ω form√°t pokud je undefined
        status: proposal.status === 'undefined' ? 'navrh' : proposal.status,
        // Zajist√≠me ≈æe coordinates jsou spr√°vn√Ω form√°t
        location: {
          ...proposal.location,
          coordinates: Array.isArray(proposal.location.coordinates) ? proposal.location.coordinates : []
        }
      };
    });
    
    console.log('Zpracovan√© n√°vrhy:', allProposals);
    
    renderProposalsOnMap();
    renderProposalsList();
    
  } catch (error) {
    console.error('Chyba p≈ôi naƒç√≠t√°n√≠ n√°vrh≈Ø z API:', error);
    
    // Zobraz√≠me chybovou zpr√°vu pro s√≠≈•ov√© chyby
    const listEl = document.getElementById('proposals-list');
    const countEl = document.getElementById('proposals-count');
    
    if (listEl) {
      listEl.innerHTML = `
        <div style="text-align: center; padding: 40px; color: #d32f2f; background: #ffebee; border-radius: 8px; margin: 20px 0;">
          <h3 style="margin: 0 0 16px 0;">‚ö†Ô∏è Chyba p≈ôi naƒç√≠t√°n√≠ dat</h3>
          <p style="margin: 0;">Nepoda≈ôilo se naƒç√≠st data z API. Zkuste obnovit str√°nku.</p>
          <details style="margin-top: 16px; text-align: left;">
            <summary style="cursor: pointer; font-weight: bold;">Technick√© informace</summary>
            <p style="font-family: monospace; font-size: 12px; background: #f5f5f5; padding: 8px; border-radius: 4px; margin-top: 8px;">
              Chyba: ${error.message}<br>
              API endpoint: {{ "/api/proposals.json" | relative_url }}
            </p>
          </details>
        </div>
      `;
    }
    
    if (countEl) {
      countEl.textContent = '0';
    }
  }
}

// Vykreslen√≠ n√°vrh≈Ø na mapƒõ
function renderProposalsOnMap() {
  proposalsLayer.clearLayers();
  
  const filteredProposals = getFilteredProposals();
  
  filteredProposals.forEach(proposal => {
    let layer;
    const color = getStatusColor(proposal.status);
    
    if (proposal.location.type === 'point') {
      const icon = L.divIcon({
        className: 'custom-marker',
        html: `<div style="background: ${color}; width: 20px; height: 20px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>`,
        iconSize: [20, 20],
        iconAnchor: [10, 10]
      });
      
      layer = L.marker(proposal.location.coordinates, { icon });
    } else if (proposal.location.type === 'polyline') {
      layer = L.polyline(proposal.location.coordinates, {
        color: color,
        weight: 4,
        opacity: 0.8
      });
    } else if (proposal.location.type === 'polygon') {
      layer = L.polygon(proposal.location.coordinates, {
        color: color,
        weight: 2,
        fillColor: color,
        fillOpacity: 0.3
      });
    }
    
    if (layer) {
      layer.bindPopup(createProposalPopup(proposal));
      layer.on('click', () => selectProposal(proposal.id));
      proposalsLayer.addLayer(layer);
    }
  });
}

// Vytvo≈ôen√≠ popup obsahu
function createProposalPopup(proposal) {
  const statusName = getStatusName(proposal.status);
  const statusIcon = getStatusIcon(proposal.status);
  
  // Vytvo≈ô√≠me odkaz na detail pouze pokud m√°me URL
  const detailLink = proposal.url ? `
    <div style="margin-top: 12px; text-align: center;">
      <a href="${proposal.url}" style="display: inline-block; padding: 6px 12px; background: #007cba; color: white; text-decoration: none; border-radius: 4px; font-size: 12px;">
        üìÑ Detail n√°vrhu
      </a>
    </div>
  ` : '';
  
  return `
    <div style="min-width: 220px;">
      <h4 style="margin: 0 0 8px; color: #333;">${proposal.title}</h4>
      <div style="font-size: 12px; color: #666; margin-bottom: 8px;">
        <div>${statusIcon} ${statusName}</div>
        <div>üë§ ${proposal.author}</div>
        ${proposal.budget ? `<div>üí∞ ${proposal.budget}</div>` : ''}
        <div>üìÖ ${new Date(proposal.dateProposed).toLocaleDateString('cs-CZ')}</div>
      </div>
      <p style="margin: 0; font-size: 13px; line-height: 1.4;">${proposal.description}</p>
      ${detailLink}
    </div>
  `;
}

// Vykreslen√≠ seznamu n√°vrh≈Ø
function renderProposalsList() {
  const filteredProposals = getFilteredProposals();
  const listEl = document.getElementById('proposals-list');
  const countEl = document.getElementById('proposals-count');
  
  countEl.textContent = filteredProposals.length;
  
  listEl.innerHTML = filteredProposals.map(proposal => {
    const statusName = getStatusName(proposal.status);
    const statusIcon = getStatusIcon(proposal.status);
    
    // Odkaz na detail
    const detailButton = proposal.url ? `
      <div style="margin-top: 12px;">
        <a href="${proposal.url}" style="display: inline-block; padding: 6px 12px; background: #007cba; color: white; text-decoration: none; border-radius: 4px; font-size: 12px;">
          üìÑ Detail
        </a>
      </div>
    ` : '';
    
    return `
      <div class="proposal-card status-${proposal.status}" onclick="selectProposal(${proposal.id})">
        <div class="proposal-title">${proposal.title}</div>
        <div class="proposal-meta">
          <span>üë§ ${proposal.author}</span>
          ${proposal.budget ? `<span>üí∞ ${proposal.budget}</span>` : ''}
        </div>
        <div style="margin-bottom: 8px;">
          <span class="proposal-status status-${proposal.status}">${statusIcon} ${statusName}</span>
        </div>
        <div style="font-size: 13px; color: #666; margin-bottom: 8px;">${proposal.description}</div>
        ${detailButton}
      </div>
    `;
  }).join('');
}

// Filtrov√°n√≠ n√°vrh≈Ø
function filterProposals() {
  activeFilters.category = document.getElementById('filter-category').value;
  activeFilters.search = document.getElementById('filter-search').value.toLowerCase();
  
  renderProposalsOnMap();
  renderProposalsList();
}

// Z√≠sk√°n√≠ filtrovan√Ωch n√°vrh≈Ø
function getFilteredProposals() {
  return allProposals.filter(proposal => {
    if (activeFilters.category && proposal.category !== activeFilters.category) return false;
    if (activeFilters.search) {
      const searchText = `${proposal.title} ${proposal.author} ${proposal.description}`.toLowerCase();
      if (!searchText.includes(activeFilters.search)) return false;
    }
    return true;
  });
}

// V√Ωbƒõr n√°vrhu
function selectProposal(proposalId) {
  const proposal = allProposals.find(p => p.id === proposalId);
  if (!proposal) return;
  
  // P≈ôibl√≠≈æen√≠ na n√°vrh
  if (proposal.location.type === 'point') {
    map.setView(proposal.location.coordinates, 17);
  } else {
    const bounds = L.latLngBounds(proposal.location.coordinates);
    map.fitBounds(bounds, { padding: [20, 20] });
  }
}


// P≈ôibl√≠≈æen√≠ na vybranou oblast
function zoomToArea(area) {
  if (!area) return;
  
  const areas = {
    'brandys': {
      center: [50.1872, 14.6634],
      zoom: 15,
      name: 'Brand√Ωs nad Labem'
    },
    'boleslav': {
      center: [50.1836, 14.6789],
      zoom: 15,
      name: 'Star√° Boleslav'
    },
    'kralovice': {
      center: [50.1745, 14.6912],
      zoom: 16,
      name: 'Kr√°lovice'
    },
    'vrabi': {
      center: [50.1923, 14.7123],
      zoom: 16,
      name: 'Vr√°b√≠'
    },
    'popovice': {
      center: [50.1656, 14.6445],
      zoom: 16,
      name: 'Popovice'
    },
    'sidliste': {
      center: [50.1834, 14.6576],
      zoom: 16,
      name: 'S√≠dli≈°tƒõ Brand√Ωs'
    }
  };
  
  const selectedArea = areas[area];
  if (selectedArea) {
    map.setView(selectedArea.center, selectedArea.zoom);
    console.log(`P≈ôibl√≠≈æeno na: ${selectedArea.name}`);
  }
}

// Pomocn√© funkce
function getStatusColor(status) {
  const colors = {
    navrh: '#2196F3',
    schvaleno: '#FF9800',
    realizace: '#9C27B0',
    hotovo: '#4CAF50',
    zamitnuto: '#F44336'
  };
  return colors[status] || '#666';
}

function getStatusName(status) {
  const names = {
    navrh: 'N√°vrh',
    schvaleno: 'Schv√°leno',
    realizace: 'V realizaci',
    hotovo: 'Hotovo',
    zamitnuto: 'Zam√≠tnuto'
  };
  return names[status] || status;
}

function getStatusIcon(status) {
  const icons = {
    navrh: 'üîµ',
    schvaleno: 'üü°',
    realizace: 'üü£',
    hotovo: 'üü¢',
    zamitnuto: 'üî¥'
  };
  return icons[status] || '‚ö™';
}

// Inicializace po naƒçten√≠ str√°nky
document.addEventListener('DOMContentLoaded', initMap);
</script>