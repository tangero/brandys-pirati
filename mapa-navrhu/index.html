---
layout: default
title: Mapa n√°vrh≈Ø
---

<style>
  .map-container {
    display: flex;
    height: calc(100vh - 120px);
    gap: 16px;
    margin: 24px 0;
  }
  
  .map-panel {
    flex: 1;
    background: var(--md-sys-color-surface);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 1px 2px rgba(0,0,0,0.3), 0 1px 3px 1px rgba(0,0,0,0.15);
  }
  
  .sidebar {
    width: 320px;
    background: var(--md-sys-color-surface-variant);
    border-radius: 12px;
    padding: 20px;
    overflow-y: auto;
    box-shadow: 0 1px 2px rgba(0,0,0,0.3), 0 1px 3px 1px rgba(0,0,0,0.15);
  }
  
  .sidebar h3 {
    margin: 0 0 16px;
    color: var(--md-sys-color-on-surface);
    font-size: 18px;
    font-weight: 500;
  }
  
  .filter-section {
    margin-bottom: 24px;
  }
  
  .filter-section label {
    display: block;
    margin-bottom: 8px;
    font-size: 14px;
    font-weight: 500;
    color: var(--md-sys-color-on-surface-variant);
  }
  
  .filter-section select,
  .filter-section input {
    width: 100%;
    padding: 12px;
    border: 1px solid var(--md-sys-color-outline);
    border-radius: 8px;
    background: var(--md-sys-color-surface);
    color: var(--md-sys-color-on-surface);
    font-size: 14px;
  }
  
  .filter-section select:focus,
  .filter-section input:focus {
    outline: 2px solid var(--md-sys-color-primary);
    border-color: var(--md-sys-color-primary);
  }
  
  .proposal-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  
  .proposal-card {
    background: var(--md-sys-color-surface);
    border-radius: 8px;
    padding: 16px;
    border-left: 4px solid var(--md-sys-color-primary);
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .proposal-card:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }
  
  .proposal-card.status-navrh { border-left-color: #2196F3; }
  .proposal-card.status-schvaleno { border-left-color: #FF9800; }
  .proposal-card.status-realizace { border-left-color: #9C27B0; }
  .proposal-card.status-hotovo { border-left-color: #4CAF50; }
  .proposal-card.status-zamitnuto { border-left-color: #F44336; }
  
  .proposal-title {
    font-weight: 500;
    margin-bottom: 4px;
    color: var(--md-sys-color-on-surface);
  }
  
  .proposal-meta {
    font-size: 12px;
    color: var(--md-sys-color-on-surface-variant);
    display: flex;
    gap: 8px;
    margin-bottom: 8px;
  }
  
  .proposal-status {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 500;
    text-transform: uppercase;
  }
  
  .proposal-status.status-navrh { background: #E3F2FD; color: #1976D2; }
  .proposal-status.status-schvaleno { background: #FFF3E0; color: #F57C00; }
  .proposal-status.status-realizace { background: #F3E5F5; color: #7B1FA2; }
  .proposal-status.status-hotovo { background: #E8F5E8; color: #388E3C; }
  .proposal-status.status-zamitnuto { background: #FFEBEE; color: #D32F2F; }
  
  .map-controls {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  
  .map-control-btn {
    background: var(--md-sys-color-primary);
    color: var(--md-sys-color-on-primary);
    border: none;
    border-radius: 8px;
    padding: 10px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 500;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    transition: all 0.2s ease;
  }
  
  .map-control-btn:hover {
    background: var(--md-sys-color-primary);
    opacity: 0.9;
    transform: translateY(-1px);
  }
  
  #map {
    height: 100%;
    width: 100%;
  }
  
  @media (max-width: 768px) {
    .map-container {
      flex-direction: column;
      height: auto;
    }
    
    .sidebar {
      width: 100%;
      order: -1;
    }
    
    .map-panel {
      height: 60vh;
    }
  }
</style>

<div class="md-section">
  <div class="md-section__header">
    <h1 class="md-section__title">Mapa n√°vrh≈Ø</h1>
    <p class="md-section__subtitle">Interaktivn√≠ mapa s n√°vrhy zmƒõn a √∫prav ve mƒõstƒõ</p>
  </div>
  
  <div class="map-container">
    <div class="map-panel">
      <div class="map-controls">
        <button class="map-control-btn" onclick="toggleLayer('cadastral')" id="btn-cadastral">
          üó∫Ô∏è Katastr
        </button>
        <button class="map-control-btn" onclick="toggleLayer('proposals')" id="btn-proposals">
          üìç N√°vrhy
        </button>
        <button class="map-control-btn" onclick="fitToBrandys()">
          üéØ Brand√Ωs
        </button>
      </div>
      <div id="map"></div>
    </div>
    
    <div class="sidebar">
      <h3>Filtry</h3>
      
      <div class="filter-section">
        <label for="filter-status">Status n√°vrhu:</label>
        <select id="filter-status" onchange="filterProposals()">
          <option value="">V≈°echny statusy</option>
          <option value="navrh">üîµ N√°vrh</option>
          <option value="schvaleno">üü° Schv√°leno</option>
          <option value="realizace">üü£ V realizaci</option>
          <option value="hotovo">üü¢ Hotovo</option>
          <option value="zamitnuto">üî¥ Zam√≠tnuto</option>
        </select>
      </div>
      
      <div class="filter-section">
        <label for="filter-category">Kategorie:</label>
        <select id="filter-category" onchange="filterProposals()">
          <option value="">V≈°echny kategorie</option>
          <option value="infrastruktura">üèóÔ∏è Infrastruktura</option>
          <option value="zelen">üå≥ Ve≈ôejn√° zele≈à</option>
          <option value="doprava">üöå Doprava</option>
          <option value="sportoviste">üéÆ Sportovi≈°tƒõ</option>
          <option value="budovy">üè¢ Ve≈ôejn√© budovy</option>
          <option value="smart-city">üí° Smart city</option>
          <option value="prostredi">‚ôªÔ∏è ≈Ωivotn√≠ prost≈ôed√≠</option>
        </select>
      </div>
      
      <div class="filter-section">
        <label for="filter-search">Vyhledat:</label>
        <input type="text" id="filter-search" placeholder="N√°zev, autor, popis..." oninput="filterProposals()">
      </div>
      
      <h3>N√°vrhy (<span id="proposals-count">0</span>)</h3>
      <div id="proposals-list" class="proposal-list">
        <!-- N√°vrhy se naƒçtou dynamicky -->
      </div>
    </div>
  </div>
</div>

<!-- Leaflet CSS a JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// Glob√°ln√≠ promƒõnn√©
let map;
let cadastralLayer;
let proposalsLayer;
let allProposals = [];
let activeFilters = {
  status: '',
  category: '',
  search: ''
};

// Inicializace mapy
function initMap() {
  // St≈ôed Brand√Ωsa nad Labem-Star√© Boleslavi
  const brandysCenter = [50.1872, 14.6634];
  
  map = L.map('map').setView(brandysCenter, 14);
  
  // Z√°kladn√≠ mapa OpenStreetMap
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap contributors',
    maxZoom: 19
  }).addTo(map);
  
  // Vytvo≈ôen√≠ vrstev
  cadastralLayer = L.layerGroup().addTo(map);
  proposalsLayer = L.layerGroup().addTo(map);
  
  // Naƒçten√≠ dat
  loadCadastralData();
  loadProposalsData();
}

// Naƒçten√≠ katastr√°ln√≠ch dat (WMS slu≈æba ƒå√öZK)
function loadCadastralData() {
  // Katastr√°ln√≠ mapa z ƒå√öZK - pouze parcely a budovy, bez popisk≈Ø
  const cadastralWMS = L.tileLayer.wms('https://services.cuzk.cz/wms/wms.asp', {
    layers: 'DEF_PARCELY,DEF_BUDOVY',
    format: 'image/png',
    transparent: true,
    attribution: '¬© ƒå√öZK',
    opacity: 0.5,
    interactive: false,
    // Skryjeme textov√© popisky parcel
    styles: '',
    maxZoom: 18
  });
  
  cadastralLayer.addLayer(cadastralWMS);
}

// Naƒçten√≠ dat n√°vrh≈Ø z Jekyll kolekce
function loadProposalsData() {
  console.log('Naƒç√≠t√°m data n√°vrh≈Ø z Jekyll kolekce...');
  
  // Data z Jekyll kolekce (vlo≈æen√° p≈ô√≠mo do str√°nky)
  const jekyllData = [
    {% for proposal in site.proposals %}
    {
      "id": {{ forloop.index }},
      "title": {{ proposal.title | jsonify }},
      "author": {{ proposal.author | jsonify }},
      "category": {{ proposal.category | jsonify }},
      "status": {{ proposal.status | jsonify }},
      "description": {{ proposal.excerpt | strip_html | strip | jsonify }},
      "location": {
        "type": {{ proposal.location.type | jsonify }},
        "coordinates": {{ proposal.location.coordinates | jsonify }},
        "address": {{ proposal.location.address | jsonify }}
      },
      "budget": {{ proposal.budget | jsonify }},
      "dateProposed": {{ proposal.date | date: "%Y-%m-%d" | jsonify }},
      "url": {{ proposal.url | jsonify }},
      "content": {{ proposal.content | strip_html | strip | jsonify }}
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ];
  
  console.log('Naƒçteno n√°vrh≈Ø z Jekyll:', jekyllData.length);
  
  if (jekyllData.length > 0) {
    allProposals = jekyllData.map(proposal => {
      // Zajist√≠me spr√°vn√Ω form√°t dat
      return {
        ...proposal,
        // P≈ôevedeme status na spr√°vn√Ω form√°t pokud je undefined
        status: proposal.status === 'undefined' ? 'navrh' : proposal.status,
        // Zajist√≠me ≈æe coordinates jsou spr√°vn√Ω form√°t
        location: {
          ...proposal.location,
          coordinates: Array.isArray(proposal.location.coordinates) ? proposal.location.coordinates : []
        }
      };
    });
    
    console.log('Zpracovan√© n√°vrhy z Jekyll:', allProposals);
    
    renderProposalsOnMap();
    renderProposalsList();
    return;
  }
  
  // Fallback na uk√°zkov√° data
  console.log('≈Ω√°dn√° data z Jekyll kolekce, pou≈æ√≠v√°m uk√°zkov√° data...');
  allProposals = [
      {
        id: 1,
        title: "Nov√© dƒõtsk√© h≈ôi≈°tƒõ u z√°kladn√≠ ≈°koly",
        author: "Patrick Zandl",
        category: "sportoviste",
        status: "navrh",
        description: "Modern√≠ dƒõtsk√© h≈ôi≈°tƒõ s prvky pro dƒõti 3-12 let",
        location: {
          type: "polygon",
          coordinates: [
            [50.1875, 14.6630],
            [50.1878, 14.6630],
            [50.1878, 14.6635],
            [50.1875, 14.6635],
            [50.1875, 14.6630]
          ]
        },
        budget: "2.5M Kƒç",
        dateProposed: "2025-08-14"
      },
      {
        id: 2,
        title: "Cyklistick√° stezka pod√©l Labe",
        author: "Jan Prokop",
        category: "doprava",
        status: "schvaleno",
        description: "Nov√° cyklistick√° stezka spojuj√≠c√≠ centrum s p≈ô√≠stavem",
        location: {
          type: "polyline",
          coordinates: [
            [50.1850, 14.6600],
            [50.1865, 14.6620],
            [50.1880, 14.6640]
          ]
        },
        budget: "5.2M Kƒç",
        dateProposed: "2025-07-20"
      },
      {
        id: 3,
        title: "Smart laviƒçky s Wi-Fi",
        author: "Luk√°≈° Findeis",
        category: "smart-city",
        status: "hotovo",
        description: "Instalace chytr√Ωch laviƒçek s nab√≠jen√≠m a Wi-Fi",
        location: {
          type: "point",
          coordinates: [50.1860, 14.6625]
        },
        budget: "450K Kƒç",
        dateProposed: "2025-05-10"
      }
  ];
  
  renderProposalsOnMap();
  renderProposalsList();
}

// Vykreslen√≠ n√°vrh≈Ø na mapƒõ
function renderProposalsOnMap() {
  proposalsLayer.clearLayers();
  
  const filteredProposals = getFilteredProposals();
  
  filteredProposals.forEach(proposal => {
    let layer;
    const color = getStatusColor(proposal.status);
    
    if (proposal.location.type === 'point') {
      const icon = L.divIcon({
        className: 'custom-marker',
        html: `<div style="background: ${color}; width: 20px; height: 20px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>`,
        iconSize: [20, 20],
        iconAnchor: [10, 10]
      });
      
      layer = L.marker(proposal.location.coordinates, { icon });
    } else if (proposal.location.type === 'polyline') {
      layer = L.polyline(proposal.location.coordinates, {
        color: color,
        weight: 4,
        opacity: 0.8
      });
    } else if (proposal.location.type === 'polygon') {
      layer = L.polygon(proposal.location.coordinates, {
        color: color,
        weight: 2,
        fillColor: color,
        fillOpacity: 0.3
      });
    }
    
    if (layer) {
      layer.bindPopup(createProposalPopup(proposal));
      layer.on('click', () => selectProposal(proposal.id));
      proposalsLayer.addLayer(layer);
    }
  });
}

// Vytvo≈ôen√≠ popup obsahu
function createProposalPopup(proposal) {
  const statusName = getStatusName(proposal.status);
  const statusIcon = getStatusIcon(proposal.status);
  
  // Vytvo≈ô√≠me odkaz na detail pouze pokud m√°me URL
  const detailLink = proposal.url ? `
    <div style="margin-top: 12px; text-align: center;">
      <a href="${proposal.url}" style="display: inline-block; padding: 6px 12px; background: #007cba; color: white; text-decoration: none; border-radius: 4px; font-size: 12px;">
        üìÑ Detail n√°vrhu
      </a>
    </div>
  ` : '';
  
  return `
    <div style="min-width: 220px;">
      <h4 style="margin: 0 0 8px; color: #333;">${proposal.title}</h4>
      <div style="font-size: 12px; color: #666; margin-bottom: 8px;">
        <div>${statusIcon} ${statusName}</div>
        <div>üë§ ${proposal.author}</div>
        ${proposal.budget ? `<div>üí∞ ${proposal.budget}</div>` : ''}
        <div>üìÖ ${new Date(proposal.dateProposed).toLocaleDateString('cs-CZ')}</div>
      </div>
      <p style="margin: 0; font-size: 13px; line-height: 1.4;">${proposal.description}</p>
      ${detailLink}
    </div>
  `;
}

// Vykreslen√≠ seznamu n√°vrh≈Ø
function renderProposalsList() {
  const filteredProposals = getFilteredProposals();
  const listEl = document.getElementById('proposals-list');
  const countEl = document.getElementById('proposals-count');
  
  countEl.textContent = filteredProposals.length;
  
  listEl.innerHTML = filteredProposals.map(proposal => {
    const statusName = getStatusName(proposal.status);
    const statusIcon = getStatusIcon(proposal.status);
    
    // Odkaz na detail
    const detailButton = proposal.url ? `
      <div style="margin-top: 12px;">
        <a href="${proposal.url}" style="display: inline-block; padding: 6px 12px; background: #007cba; color: white; text-decoration: none; border-radius: 4px; font-size: 12px;">
          üìÑ Detail
        </a>
      </div>
    ` : '';
    
    return `
      <div class="proposal-card status-${proposal.status}" onclick="selectProposal(${proposal.id})">
        <div class="proposal-title">${proposal.title}</div>
        <div class="proposal-meta">
          <span>üë§ ${proposal.author}</span>
          ${proposal.budget ? `<span>üí∞ ${proposal.budget}</span>` : ''}
        </div>
        <div style="margin-bottom: 8px;">
          <span class="proposal-status status-${proposal.status}">${statusIcon} ${statusName}</span>
        </div>
        <div style="font-size: 13px; color: #666; margin-bottom: 8px;">${proposal.description}</div>
        ${detailButton}
      </div>
    `;
  }).join('');
}

// Filtrov√°n√≠ n√°vrh≈Ø
function filterProposals() {
  activeFilters.status = document.getElementById('filter-status').value;
  activeFilters.category = document.getElementById('filter-category').value;
  activeFilters.search = document.getElementById('filter-search').value.toLowerCase();
  
  renderProposalsOnMap();
  renderProposalsList();
}

// Z√≠sk√°n√≠ filtrovan√Ωch n√°vrh≈Ø
function getFilteredProposals() {
  return allProposals.filter(proposal => {
    if (activeFilters.status && proposal.status !== activeFilters.status) return false;
    if (activeFilters.category && proposal.category !== activeFilters.category) return false;
    if (activeFilters.search) {
      const searchText = `${proposal.title} ${proposal.author} ${proposal.description}`.toLowerCase();
      if (!searchText.includes(activeFilters.search)) return false;
    }
    return true;
  });
}

// V√Ωbƒõr n√°vrhu
function selectProposal(proposalId) {
  const proposal = allProposals.find(p => p.id === proposalId);
  if (!proposal) return;
  
  // P≈ôibl√≠≈æen√≠ na n√°vrh
  if (proposal.location.type === 'point') {
    map.setView(proposal.location.coordinates, 17);
  } else {
    const bounds = L.latLngBounds(proposal.location.coordinates);
    map.fitBounds(bounds, { padding: [20, 20] });
  }
}

// P≈ôep√≠n√°n√≠ vrstev
function toggleLayer(layerName) {
  const btn = document.getElementById(`btn-${layerName}`);
  
  if (layerName === 'cadastral') {
    if (map.hasLayer(cadastralLayer)) {
      map.removeLayer(cadastralLayer);
      btn.style.opacity = '0.5';
    } else {
      map.addLayer(cadastralLayer);
      btn.style.opacity = '1';
    }
  } else if (layerName === 'proposals') {
    if (map.hasLayer(proposalsLayer)) {
      map.removeLayer(proposalsLayer);
      btn.style.opacity = '0.5';
    } else {
      map.addLayer(proposalsLayer);
      btn.style.opacity = '1';
    }
  }
}

// P≈ôibl√≠≈æen√≠ na Brand√Ωs
function fitToBrandys() {
  map.setView([50.1872, 14.6634], 14);
}

// Pomocn√© funkce
function getStatusColor(status) {
  const colors = {
    navrh: '#2196F3',
    schvaleno: '#FF9800',
    realizace: '#9C27B0',
    hotovo: '#4CAF50',
    zamitnuto: '#F44336'
  };
  return colors[status] || '#666';
}

function getStatusName(status) {
  const names = {
    navrh: 'N√°vrh',
    schvaleno: 'Schv√°leno',
    realizace: 'V realizaci',
    hotovo: 'Hotovo',
    zamitnuto: 'Zam√≠tnuto'
  };
  return names[status] || status;
}

function getStatusIcon(status) {
  const icons = {
    navrh: 'üîµ',
    schvaleno: 'üü°',
    realizace: 'üü£',
    hotovo: 'üü¢',
    zamitnuto: 'üî¥'
  };
  return icons[status] || '‚ö™';
}

// Inicializace po naƒçten√≠ str√°nky
document.addEventListener('DOMContentLoaded', initMap);
</script>